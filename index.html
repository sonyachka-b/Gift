<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Valentine's Day, Love! ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --pink: #FFB6C1;
            --dark-pink: #FF69B4;
            --red: #DC143C;
            --beige: #F5E6D3;
            --cream: #FFF8F0;
            --brown: #8B4513;
            --blue: #87CEEB;
            --purple: #DDA0DD;
            --green: #90EE90;
            --orange: #FFB347;
            --yellow: #FFE66D;
        }

        body {
            font-family: 'Silkscreen', cursive;
            background: var(--cream);
            color: var(--brown);
            overflow-x: hidden;
        }

        /* Pixel hearts background */
        .hearts-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .pixel-heart {
            position: absolute;
            width: 16px;
            height: 16px;
            animation: float 10s infinite;
            opacity: 0.4;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            50% {
                opacity: 0.4;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Home page */
        .home-page {
            text-align: center;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(24px, 5vw, 48px);
            color: var(--red);
            margin-bottom: 30px;
            text-shadow: 3px 3px 0 var(--pink);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            font-size: clamp(14px, 2vw, 18px);
            color: var(--dark-pink);
            margin-bottom: 50px;
        }

        /* Card grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            justify-items: center;
        }

        .card {
            background: white;
            border: 4px solid var(--brown);
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 8px 8px 0 var(--pink);
            position: relative;
            overflow: hidden;
            width: 280px;
        }

        .card:hover {
            transform: translate(-4px, -4px);
            box-shadow: 12px 12px 0 var(--pink);
        }

        .card:active {
            transform: translate(0, 0);
            box-shadow: 4px 4px 0 var(--pink);
        }

        .card-icon {
            font-size: 64px;
            margin-bottom: 20px;
            display: block;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .card:nth-child(1) .card-icon { animation-delay: 0s; }
        .card:nth-child(2) .card-icon { animation-delay: 0.2s; }
        .card:nth-child(3) .card-icon { animation-delay: 0.4s; }

        .card h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            color: var(--red);
            margin-bottom: 10px;
        }

        .card p {
            font-size: 14px;
            color: var(--brown);
            line-height: 1.6;
        }

        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--red);
            color: white;
            border: 3px solid var(--brown);
            padding: 12px 24px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--brown);
            transition: all 0.2s;
            z-index: 100;
        }

        .back-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--brown);
        }

        .back-btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 var(--brown);
        }

        /* Page transitions */
        .page {
            display: none;
            animation: slideIn 0.5s ease-out;
            max-width: 1200px;
            width: 100%;
        }

        .page.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .hidden {
            display: none !important;
        }

        /* ========== MAIL PAGE ========== */
        .mail-container {
            background: white;
            border: 4px solid var(--brown);
            padding: 40px;
            box-shadow: 12px 12px 0 var(--pink);
        }

        .mail-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .mail-header h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 28px;
            color: var(--red);
            margin-bottom: 20px;
        }

        .mailboxes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .mailbox {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .mailbox:hover {
            transform: scale(1.05);
        }

        .mailbox-icon {
            width: 120px;
            height: 140px;
            margin: 0 auto 15px;
            position: relative;
            border: 4px solid var(--brown);
            background: var(--beige);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }

        .mailbox-flag {
            position: absolute;
            top: 10px;
            right: -10px;
            width: 30px;
            height: 20px;
            background: var(--red);
            border: 2px solid var(--brown);
        }

        .mailbox-door {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 50px;
            background: var(--brown);
            border: 3px solid var(--brown);
        }

        .mailbox-slot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 8px;
            background: var(--brown);
        }

        .mailbox.sad .mailbox-icon { background: var(--blue); }
        .mailbox.lonely .mailbox-icon { background: var(--purple); }
        .mailbox.discouraged .mailbox-icon { background: #A9A9A9; }
        .mailbox.proud .mailbox-icon { background: var(--yellow); }
        .mailbox.lazy .mailbox-icon { background: var(--green); }
        .mailbox.happy .mailbox-icon { background: var(--pink); }
        .mailbox.tired .mailbox-icon { background: var(--orange); }

        .mailbox-label {
            font-size: 14px;
            color: var(--brown);
            font-weight: bold;
        }

        .letter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .letter-overlay.active {
            display: flex;
        }

        .letter-content {
            background: var(--beige);
            border: 4px solid var(--brown);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            position: relative;
            animation: popIn 0.5s;
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .letter-content h3 {
            font-family: 'Press Start 2P', cursive;
            color: var(--red);
            font-size: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .letter-content p {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .close-letter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--red);
            color: white;
            border: 3px solid var(--brown);
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
        }

        .signature {
            text-align: right;
            font-style: italic;
            color: var(--red);
            margin-top: 30px;
        }

        /* ========== PHOTO BOOTH PAGE ========== */
        .photobooth-container {
            background: white;
            border: 4px solid var(--brown);
            padding: 40px;
            box-shadow: 12px 12px 0 var(--pink);
            text-align: center;
            position: relative;
        }

        .curtain-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 150;
            pointer-events: none;
            display: none;
        }

        .curtain-overlay.active {
            display: block;
        }

        .curtain {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background: var(--red);
            border: 3px solid var(--brown);
            transition: transform 1s ease-in-out;
        }

        .curtain-left {
            left: 0;
            transform: translateX(0);
        }

        .curtain-right {
            right: 0;
            transform: translateX(0);
        }

        .curtain-overlay.open .curtain-left {
            transform: translateX(-100%);
        }

        .curtain-overlay.open .curtain-right {
            transform: translateX(100%);
        }

        .photobooth-header h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 28px;
            color: var(--red);
            margin-bottom: 15px;
        }

        .photobooth-subtitle {
            color: var(--dark-pink);
            margin-bottom: 30px;
            font-size: 16px;
        }

        .camera-section {
            margin: 30px 0;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            border: 4px solid var(--brown);
            background: black;
            box-shadow: 8px 8px 0 var(--pink);
        }

        #video {
            width: 100%;
            display: block;
            transform: scaleX(-1);
        }

        #canvas {
            display: none;
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .countdown-overlay.active {
            display: flex;
        }

        .countdown-number {
            font-family: 'Press Start 2P', cursive;
            font-size: 120px;
            color: white;
            text-shadow: 4px 4px 0 var(--red);
            animation: countdownPulse 1s ease-in-out;
        }

        @keyframes countdownPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--red);
            color: white;
            border: 3px solid var(--brown);
            padding: 12px 24px;
            font-family: 'Silkscreen', cursive;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--brown);
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--brown);
        }

        .btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 var(--brown);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .photo-strip {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .photo-strip-download {
            background: white;
            border: 4px solid var(--brown);
            padding: 20px;
            margin: 30px auto;
            max-width: 400px;
            box-shadow: 8px 8px 0 var(--pink);
            display: none;
        }

        .photo-strip-download.active {
            display: block;
        }

        .photo-strip-download h3 {
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            color: var(--red);
            margin-bottom: 20px;
            text-align: center;
        }

        .strip-container {
            background: white;
            border: 3px solid var(--brown);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .strip-photo {
            width: 100%;
            border: 2px solid var(--brown);
        }

        .strip-photo img {
            width: 100%;
            display: block;
            filter: grayscale(100%) contrast(1.1) sepia(20%);
        }

        .photo-frame {
            background: white;
            border: 4px solid var(--brown);
            padding: 15px;
            box-shadow: 6px 6px 0 var(--beige);
            position: relative;
            animation: slideOut 0.8s ease-out;
        }

        @keyframes slideOut {
            0% {
                transform: translateY(100px) scale(0.8);
                opacity: 0;
            }
            60% {
                transform: translateY(-10px) scale(1.05);
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .photo-frame img {
            width: 100%;
            display: block;
            filter: grayscale(100%) contrast(1.1) sepia(20%);
        }

        .loading-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            color: var(--red);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* ========== CAFE PAGE ========== */
        .cafe-container {
            background: white;
            border: 4px solid var(--brown);
            padding: 40px;
            box-shadow: 12px 12px 0 var(--pink);
            text-align: center;
        }

        .cafe-header h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 28px;
            color: var(--red);
            margin-bottom: 15px;
        }

        .cafe-subtitle {
            color: var(--dark-pink);
            margin-bottom: 40px;
            font-size: 18px;
        }

        .decision-screen {
            display: none;
            animation: fadeIn 0.5s;
        }

        .decision-screen.active {
            display: block;
        }

        .decision-question {
            font-family: 'Press Start 2P', cursive;
            font-size: 22px;
            color: var(--brown);
            margin-bottom: 40px;
        }

        .decision-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 600px;
            margin: 0 auto;
        }

        .decision-btn {
            flex: 1;
            min-width: 200px;
            background: var(--pink);
            color: var(--brown);
            border: 4px solid var(--brown);
            padding: 20px 30px;
            font-family: 'Silkscreen', cursive;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 6px 6px 0 var(--brown);
            transition: all 0.2s;
        }

        .decision-btn:hover {
            transform: translate(-3px, -3px);
            box-shadow: 9px 9px 0 var(--brown);
            background: var(--dark-pink);
            color: white;
        }

        .decision-btn:active {
            transform: translate(0, 0);
            box-shadow: 3px 3px 0 var(--brown);
        }

        .results-container {
            margin-top: 40px;
        }

        .results-list {
            display: grid;
            gap: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .result-item {
            background: var(--beige);
            border: 3px solid var(--brown);
            padding: 25px;
            text-align: left;
            box-shadow: 4px 4px 0 var(--pink);
        }

        .result-item h4 {
            font-size: 20px;
            color: var(--red);
            margin-bottom: 10px;
        }

        .result-item p {
            font-size: 14px;
            line-height: 1.6;
        }

        .restart-btn {
            margin-top: 30px;
            background: var(--brown);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
                max-width: 400px;
            }

            h1 {
                font-size: 24px;
            }

            .mail-container,
            .photobooth-container,
            .cafe-container {
                padding: 20px;
            }

            .back-btn {
                font-size: 10px;
                padding: 8px 16px;
            }

            .mailboxes-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .decision-btn {
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Pixel hearts background -->
    <div class="hearts-bg" id="heartsContainer"></div>

    <!-- Curtain overlay for photo booth transition -->
    <div class="curtain-overlay" id="curtainOverlay">
        <div class="curtain curtain-left"></div>
        <div class="curtain curtain-right"></div>
    </div>

    <!-- Back button -->
    <button class="back-btn hidden" id="backBtn" onclick="goHome()">‚Üê BACK</button>

    <div class="container">
        <!-- HOME PAGE -->
        <div class="home-page" id="homePage">
            <h1>üíù Happy Valentine's Day! üíù</h1>
            <p class="subtitle">Click on a card to explore your special gift</p>

            <div class="cards-grid">
                <div class="card" onclick="showPage('mail')">
                    <span class="card-icon">üíå</span>
                    <h2>Mail</h2>
                    <p>Special letters written with love</p>
                </div>

                <div class="card" onclick="showPage('photobooth')">
                    <span class="card-icon">üì∏</span>
                    <h2>Photo Booth</h2>
                    <p>Capture our memories together</p>
                </div>

                <div class="card" onclick="showPage('cafe')">
                    <span class="card-icon">‚òï</span>
                    <h2>Sonya's Caf√©</h2>
                    <p>What are you in the mood for today?</p>
                </div>
            </div>
        </div>

        <!-- MAIL PAGE -->
        <div class="page" id="mailPage">
            <div class="mail-container">
                <div class="mail-header">
                    <h2>üíå Open When You're Feeling... üíå</h2>
                    <p style="color: var(--dark-pink); margin-top: 15px;">Choose a mailbox based on your mood</p>
                </div>

                <div class="mailboxes-grid">
                    <div class="mailbox sad" onclick="openLetter('sad')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Sad</div>
                    </div>

                    <div class="mailbox lonely" onclick="openLetter('lonely')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Lonely</div>
                    </div>

                    <div class="mailbox discouraged" onclick="openLetter('discouraged')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Discouraged</div>
                    </div>

                    <div class="mailbox proud" onclick="openLetter('proud')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Proud</div>
                    </div>

                    <div class="mailbox lazy" onclick="openLetter('lazy')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Lazy</div>
                    </div>

                    <div class="mailbox happy" onclick="openLetter('happy')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Happy</div>
                    </div>

                    <div class="mailbox tired" onclick="openLetter('tired')">
                        <div class="mailbox-icon">
                            <div class="mailbox-flag"></div>
                            <div class="mailbox-slot"></div>
                            <div class="mailbox-door"></div>
                        </div>
                        <div class="mailbox-label">Tired</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Letter overlay -->
        <div class="letter-overlay" id="letterOverlay">
            <div class="letter-content" id="letterContent">
                <button class="close-letter" onclick="closeLetter()">‚úï</button>
                <!-- Content will be inserted by JavaScript -->
            </div>
        </div>

        <!-- PHOTO BOOTH PAGE -->
        <div class="page" id="photoboothPage">
            <div class="photobooth-container">
                <div class="photobooth-header">
                    <h2>üì∏ Photo Booth üì∏</h2>
                    <p class="photobooth-subtitle">Don't forget to smile!</p>
                </div>

                <div class="camera-section">
                    <div class="video-container">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas"></canvas>
                        <div class="countdown-overlay" id="countdownOverlay">
                            <div class="countdown-number" id="countdownNumber">3</div>
                        </div>
                    </div>

                    <div class="camera-controls">
                        <button class="btn" id="startCamera" onclick="startCamera()">Start Camera</button>
                        <button class="btn" id="captureBtn" onclick="startPhotoSession()" disabled>Take Photo Strip üì∏</button>
                    </div>
                </div>

                <div class="photo-strip-download" id="photoStripDownload">
                    <h3>Your Photo Strip! üì∏</h3>
                    <div class="strip-container" id="stripContainer">
                        <!-- 4 photos will be inserted here -->
                    </div>
                    <button class="btn" style="margin-top: 20px; width: 100%;" onclick="downloadStrip()">Download Your Strip, Cutie! üíæ</button>
                    <button class="btn" style="margin-top: 10px; width: 100%; background: var(--brown);" onclick="resetPhotoSession()">Make Another Strip</button>
                </div>

                <div class="photo-strip" id="photoStrip">
                    <!-- Individual photos preview will be added here during capture -->
                </div>
            </div>
        </div>

        <!-- CAFE PAGE -->
        <div class="page" id="cafePage">
            <div class="cafe-container">
                <div class="cafe-header">
                    <h2>‚òï Sonya's Caf√© ‚òï</h2>
                    <p class="cafe-subtitle">Let's find the perfect recommendation for you!</p>
                </div>

                <!-- Screen 1: Drink or Food -->
                <div class="decision-screen active" id="screen1">
                    <div class="decision-question">What are you feeling like?</div>
                    <div class="decision-buttons">
                        <button class="decision-btn" onclick="selectChoice('drink')">ü•§ Drink</button>
                        <button class="decision-btn" onclick="selectChoice('food')">üç¥ Food</button>
                    </div>
                </div>

                <!-- Screen 2: Hot or Cold -->
                <div class="decision-screen" id="screen2">
                    <div class="decision-question">Hot or Cold?</div>
                    <div class="decision-buttons">
                        <button class="decision-btn" onclick="selectTemp('hot')">üî• Hot</button>
                        <button class="decision-btn" onclick="selectTemp('cold')">‚ùÑÔ∏è Cold</button>
                    </div>
                </div>

                <!-- Screen 3: Sweet preference -->
                <div class="decision-screen" id="screen3">
                    <div class="decision-question">How sweet?</div>
                    <div class="decision-buttons">
                        <button class="decision-btn" onclick="selectSweet('sweet')">üç≠ Sweet</button>
                        <button class="decision-btn" onclick="selectSweet('not-sweet')">üßÇ Not Too Sweet</button>
                    </div>
                </div>

                <!-- Results -->
                <div class="decision-screen" id="results">
                    <div class="decision-question">Here are your perfect matches! ‚ú®</div>
                    <div class="results-container">
                        <div class="results-list" id="resultsList">
                            <!-- Results will be inserted here -->
                        </div>
                        <button class="btn restart-btn" onclick="restartCafe()">Start Over</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== PIXEL HEARTS BACKGROUND ==========
        function createPixelHearts() {
            const container = document.getElementById('heartsContainer');
            const colors = ['#FF69B4', '#DC143C', '#FFB6C1', '#FF1493'];

            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'pixel-heart';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 5 + 8) + 's';
                heart.style.animationDelay = Math.random() * 5 + 's';

                // Create pixel heart using inline SVG
                const color = colors[Math.floor(Math.random() * colors.length)];
                heart.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 16 16">
                        <rect x="4" y="2" width="2" height="2" fill="${color}"/>
                        <rect x="10" y="2" width="2" height="2" fill="${color}"/>
                        <rect x="2" y="4" width="12" height="2" fill="${color}"/>
                        <rect x="2" y="6" width="12" height="2" fill="${color}"/>
                        <rect x="2" y="8" width="12" height="2" fill="${color}"/>
                        <rect x="4" y="10" width="8" height="2" fill="${color}"/>
                        <rect x="6" y="12" width="4" height="2" fill="${color}"/>
                    </svg>
                `;
                container.appendChild(heart);
            }
        }

        // ========== PAGE NAVIGATION ==========
        function showPage(pageId) {
            document.getElementById('homePage').style.display = 'none';
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId + 'Page').classList.add('active');
            document.getElementById('backBtn').classList.remove('hidden');

            // Special transition for photo booth
            if (pageId === 'photobooth') {
                const curtain = document.getElementById('curtainOverlay');
                curtain.classList.add('active');
                curtain.classList.add('open');
                setTimeout(() => {
                    curtain.classList.remove('active');
                    curtain.classList.remove('open');
                }, 1500);
            }
        }

        function goHome() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('backBtn').classList.add('hidden');

            // Stop camera if active
            if (window.stream) {
                window.stream.getTracks().forEach(track => track.stop());
            }
        }

        // ========== MAIL PAGE ==========
        const letters = {
            sad: {
                title: "When You're Feeling Sad üíô",
                content: `
                    <p>My love, Tyomochka,</p>
                    <p>I know some days are harder than others, and that's okay. It's okay to feel sad, to sit with those feelings for a while.</p>
                    <p>But I want you to know that I'm here for you all the time. Your sadness doesn't make you any less amazing!.</p>
                    <p>Look at your amazing life, amazing people around you, amazing moments you had! Are you still sad?</p>
                    <p>Take your time. Feel what you need to feel. And when you're ready, I'll try to be there for yout with a hug or your favorite snack! Just call me. </p>
                    <div class="signature">You're not alone ‚ù§Ô∏è<br>Sonyachka</div>
                `
            },
            lonely: {
                title: "When You're Feeling Lonely üíú",
                content: `
                    <p>Hey you,</p>
                    <p>I'm really missing you right now. I wish I could teleport to you instantly and wrap you in the biggest hug.</p>
                    <p>Distance might keep us apart, but I'm right there with you in the small lego pieces we've built, in the pics we made in the national parks, in the toys, clothes, stickers I gave you.</p>
                    <p>You're never alone, Tyomochka. I'm always thinking about you. We're connected by something so much stronger than physical presense.</p>
                    <p>Until we're together again, remember: you've got this, and you've got me!</p>
                    <div class="signature">Sending you all the hugs in the world üíï<br>Meow</div>
                `
            },
            discouraged: {
                title: "When You're Feeling Discouraged üåü",
                content: `
                    <p>My amazing Tyomochka,</p>
                    <p>I see you. I see how hard you're trying, even when it feels like nothing is working out. I see your effort, your determination, your incredible strength during those late nights.</p>
                    <p>Sometimes goes srong and that's really frustrating. But you know what? You've overcome so many obstacles before. You're capable of anything and so much stronger than you think.</p>
                    <p>This setback is there to prepare you for something bigger . I believe in you more than I can express in words. You've got this.</p>
                    <p>Keep going, because you're doing better than you realize, and I'm so proud of you.</p>
                    <div class="signature">Believing in you!!! üåà<br>Your biggest fan</div>
                `
            },
            proud: {
                title: "When You're Feeling Proud üéâ",
                content: `
                    <p>Look at you!</p>
                    <p>You did it! Whatever "it" is, I'm so incredibly proud of you! You worked hard, you persevered, and you made it happen!</p>
                    <p>I knew you could do it, but there's something extra special about watching you achieve your goals. Your success makes me want to celebrate, because I love seeing you happy and satisfied.</p>
                    <p>You deserve all the good and amazing things. You've earned this moment, so please take time to really enjoy it and be proud of yourself.</p>
                    <p>Please go celebrate, get your favorite coffee and dessert! üéä</p>
                    <div class="signature">Sooooo proud of you! üèÜ<br>Kisses!</div>
                `
            },
            lazy: {
                title: "When You're Feeling Lazy üò¥",
                content: `
                    <p>Hey little monkey,</p>
                    <p>First of all - it's totally okay to have lazy days! Rest is productive. Relaxation is necessary. You don't always have to be "on."</p>
                    <p>So go ahead - stay in your bed for a while, make some comfort food, do absolutely nothing if that's what you need. You've earned it!</p>
                    <p>Some of my favorite memories with you are our lazy days together - just existing in the same space, comfortable and cozy. Those moments will always be in my heart.</p>
                    <p>Enjoy your chill time guilt-free. Tomorrow is a new day, but today? Today is for resting.</p>
                    <div class="signature">Lazying around with you in spirit üõãÔ∏è<br>Your lazy sister</div>
                `
            },
            happy: {
                title: "When You're Feeling Happy üòä",
                content: `
                    <p>My loooove,</p>
                    <p>I'm so happy that you're happy! Even reading this, I can picture your smile, and it makes my whole day brighter.</p>
                    <p>I love seeing you happy. Your smile is one of my favorite things in the entire world.</p>
                    <p>Hold onto this feeling! Write something down in your notebook for this moment so you can return to it whenever you need a boost.</p>
                    <p>Thank you for sharing your happiness with me.</p>
                    <div class="signature">Happy because you're happy! üåû<br>Your Sonyachkaaaa</div>
                `
            },
            tired: {
                title: "When You're Feeling Tired üò¥",
                content: `
                    <p>My hardworking love,</p>
                    <p>You've been pushing yourself so hard, and I see it. You're allowed to be tired. You probably need to rest.</p>
                    <p>Take a break. Take a nap. Take a whole day if you need it. Your worth isn't measured by your productivity, please remember that.</p>
                    <p>I wish I could be there to make you tea, cuddle with you a little bit and let you sleep peacefully while I take care of everything else. Since I can't, please do something nice for yourself.</p>
                    <p>Rest up, recharge, and remember - you don't have to do everything today. Some things can wait. Your health can't.</p>
                    <div class="signature">Wishing you sweet dreams üåô<br>Love you!<3</div>
                `
            }
        };

        function openLetter(mood) {
            const overlay = document.getElementById('letterOverlay');
            const content = document.getElementById('letterContent');
            const letter = letters[mood];

            content.innerHTML = `
                <button class="close-letter" onclick="closeLetter()">‚úï</button>
                <h3>${letter.title}</h3>
                ${letter.content}
            `;

            overlay.classList.add('active');
        }

        function closeLetter() {
            document.getElementById('letterOverlay').classList.remove('active');
        }

        // ========== PHOTO BOOTH ==========
        let stream = null;
        let capturedPhotos = [];

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' },
                    audio: false 
                });

                const video = document.getElementById('video');
                video.srcObject = stream;

                document.getElementById('startCamera').disabled = true;
                document.getElementById('captureBtn').disabled = false;
            } catch (err) {
                alert('Could not access camera. Please allow camera permissions.');
                console.error('Camera error:', err);
            }
        }

        async function startPhotoSession() {
            capturedPhotos = [];
            document.getElementById('photoStrip').innerHTML = '';
            document.getElementById('stripContainer').innerHTML = '';
            document.getElementById('photoStripDownload').classList.remove('active');
            document.getElementById('captureBtn').disabled = true;

            // Take 4 photos with countdown
            for (let i = 0; i < 4; i++) {
                await countdown();
                await capturePhoto(i + 1);
                await sleep(1000); // Wait 1 second between photos
            }

            // Show loading
            showLoading();
            await sleep(2000);

            // Create and show the strip
            createPhotoStrip();
            document.getElementById('captureBtn').disabled = false;
        }

        function countdown() {
            return new Promise((resolve) => {
                const overlay = document.getElementById('countdownOverlay');
                const numberEl = document.getElementById('countdownNumber');
                let count = 3;

                overlay.classList.add('active');
                numberEl.textContent = count;

                const interval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        numberEl.textContent = count;
                        // Restart animation
                        numberEl.style.animation = 'none';
                        setTimeout(() => {
                            numberEl.style.animation = 'countdownPulse 1s ease-in-out';
                        }, 10);
                    } else {
                        clearInterval(interval);
                        overlay.classList.remove('active');
                        resolve();
                    }
                }, 1000);
            });
        }

        function capturePhoto(photoNumber) {
            return new Promise((resolve) => {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');

                // Set canvas size to match video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                // Draw video frame to canvas (flip it back to normal for the photo)
                const ctx = canvas.getContext('2d');
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
                ctx.restore();

                const photoUrl = canvas.toDataURL('image/png');
                capturedPhotos.push(photoUrl);

                // Show preview
                const photoFrame = document.createElement('div');
                photoFrame.className = 'photo-frame';
                photoFrame.innerHTML = `<img src="${photoUrl}" alt="Photo ${photoNumber}">`;
                document.getElementById('photoStrip').appendChild(photoFrame);

                resolve();
            });
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'photo-frame';
            loadingDiv.innerHTML = '<div class="loading-animation">LOADING...</div>';
            document.getElementById('photoStrip').appendChild(loadingDiv);
        }

        function createPhotoStrip() {
            // Remove loading indicator
            const loading = document.getElementById('loadingIndicator');
            if (loading) loading.remove();

            const stripContainer = document.getElementById('stripContainer');
            stripContainer.innerHTML = '';

            // Add all 4 photos to the strip
            capturedPhotos.forEach((photoUrl, index) => {
                const stripPhoto = document.createElement('div');
                stripPhoto.className = 'strip-photo';
                stripPhoto.innerHTML = `<img src="${photoUrl}" alt="Photo ${index + 1}">`;
                stripContainer.appendChild(stripPhoto);
            });

            document.getElementById('photoStripDownload').classList.add('active');
        }

        function downloadStrip() {
            // Create a canvas with all 4 photos in a vertical strip
            const stripCanvas = document.createElement('canvas');
            const ctx = stripCanvas.getContext('2d');

            // Load first image to get dimensions
            const img = new Image();
            img.onload = () => {
                const photoWidth = img.width;
                const photoHeight = img.height;
                const padding = 30;
                const gap = 20;

                stripCanvas.width = photoWidth + (padding * 2);
                stripCanvas.height = (photoHeight * 4) + (gap * 3) + (padding * 2);

                // White background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

                // Draw border
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 6;
                ctx.strokeRect(3, 3, stripCanvas.width - 6, stripCanvas.height - 6);

                let promises = [];
                capturedPhotos.forEach((photoUrl, index) => {
                    const promise = new Promise((resolve) => {
                        const photo = new Image();
                        photo.onload = () => {
                            const y = padding + (index * (photoHeight + gap));
                            ctx.drawImage(photo, padding, y, photoWidth, photoHeight);

                            // Add border around each photo
                            ctx.strokeStyle = '#8B4513';
                            ctx.lineWidth = 3;
                            ctx.strokeRect(padding, y, photoWidth, photoHeight);

                            resolve();
                        };
                        photo.src = photoUrl;
                    });
                    promises.push(promise);
                });

                Promise.all(promises).then(() => {
                    // Download the strip
                    const link = document.createElement('a');
                    link.href = stripCanvas.toDataURL('image/png');
                    link.download = `photobooth-strip-${Date.now()}.png`;
                    link.click();
                });
            };
            img.src = capturedPhotos[0];
        }

        function resetPhotoSession() {
            capturedPhotos = [];
            document.getElementById('photoStrip').innerHTML = '';
            document.getElementById('stripContainer').innerHTML = '';
            document.getElementById('photoStripDownload').classList.remove('active');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ========== CAFE ==========
        let cafeChoices = {
            type: '',
            temp: '',
            sweet: ''
        };

        function selectChoice(choice) {
            cafeChoices.type = choice;
            document.getElementById('screen1').classList.remove('active');
            document.getElementById('screen2').classList.add('active');
        }

        function selectTemp(temp) {
            cafeChoices.temp = temp;
            document.getElementById('screen2').classList.remove('active');
            document.getElementById('screen3').classList.add('active');
        }

        function selectSweet(sweet) {
            cafeChoices.sweet = sweet;
            document.getElementById('screen3').classList.remove('active');
            showResults();
        }

        function showResults() {
            const resultsList = document.getElementById('resultsList');
            const results = getRecommendations(cafeChoices);

            resultsList.innerHTML = results.map(item => `
                <div class="result-item">
                    <h4>${item.icon} ${item.name}</h4>
                    <p>${item.description}</p>
                </div>
            `).join('');

            document.getElementById('results').classList.add('active');
        }

        function getRecommendations(choices) {
            const recommendations = {
                'drink-hot-sweet': [
                    { icon: '‚òï', name: 'Caramel Latte', description: 'Sweet and creamy with a perfect espresso kick' },
                    { icon: 'üç´', name: 'Hot Chocolate', description: 'Rich, indulgent, and topped with whipped cream' },
                    { icon: 'ü´ñ', name: 'Vanilla Chai Latte', description: 'Spiced tea with sweet vanilla notes' }
                ],
                'drink-hot-not-sweet': [
                    { icon: '‚òï', name: 'Black Coffee', description: 'Strong, bold, and pure coffee flavor' },
                    { icon: 'üçµ', name: 'Green Tea', description: 'Light, refreshing, and healthy' },
                    { icon: '‚òï', name: 'Americano', description: 'Smooth espresso with hot water' }
                ],
                'drink-cold-sweet': [
                    { icon: 'üßã', name: 'Bubble Tea', description: 'Sweet, fun, and full of chewy tapioca pearls' },
                    { icon: 'ü•§', name: 'Iced Vanilla Latte', description: 'Cold, sweet, and perfectly caffeinated' },
                    { icon: 'üçπ', name: 'Fruit Smoothie', description: 'Refreshing blend of fruits and sweetness' }
                ],
                'drink-cold-not-sweet': [
                    { icon: 'üßä', name: 'Iced Coffee', description: 'Cool, smooth, and refreshing' },
                    { icon: 'üßÉ', name: 'Unsweetened Iced Tea', description: 'Light and crisp with natural tea flavor' },
                    { icon: 'üíß', name: 'Cold Brew', description: 'Smooth, less acidic, bold coffee' }
                ],
                'food-hot-sweet': [
                    { icon: 'ü•ê', name: 'Chocolate Croissant', description: 'Buttery pastry with melted chocolate inside' },
                    { icon: 'üßá', name: 'Belgian Waffles', description: 'Fluffy waffles with syrup and berries' },
                    { icon: 'üç©', name: 'Cinnamon Roll', description: 'Warm, gooey, and absolutely delicious' }
                ],
                'food-hot-not-sweet': [
                    { icon: 'üçï', name: 'Pizza Slice', description: 'Hot, cheesy, and satisfying' },
                    { icon: 'ü•ô', name: 'Grilled Panini', description: 'Pressed sandwich with melted cheese' },
                    { icon: 'üçú', name: 'Soup & Bread', description: 'Warm, comforting, and filling' }
                ],
                'food-cold-sweet': [
                    { icon: 'üç∞', name: 'Cheesecake', description: 'Creamy, sweet, and decadent' },
                    { icon: 'üç®', name: 'Ice Cream', description: 'Cold, sweet, and comes in endless flavors' },
                    { icon: 'ü•ó', name: 'Fruit Salad', description: 'Fresh, naturally sweet, and healthy' }
                ],
                'food-cold-not-sweet': [
                    { icon: 'ü•ó', name: 'Caesar Salad', description: 'Crisp romaine with parmesan and croutons' },
                    { icon: 'ü•™', name: 'Club Sandwich', description: 'Stacked high with turkey, bacon, and veggies' },
                    { icon: 'üç±', name: 'Sushi Roll', description: 'Fresh, light, and perfectly balanced' }
                ]
            };

            const key = `${choices.type}-${choices.temp}-${choices.sweet}`;
            return recommendations[key] || [];
        }

        function restartCafe() {
            cafeChoices = { type: '', temp: '', sweet: '' };
            document.querySelectorAll('.decision-screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('screen1').classList.add('active');
        }

        // ========== INITIALIZE ==========
        createPixelHearts();

        // Close letter on overlay click
        document.getElementById('letterOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLetter();
            }
        });
    </script>
</body>
</html>
